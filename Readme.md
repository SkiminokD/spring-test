# О программе

Данное тестовое микросервисное веб-приложение написано в ходе чтения книги автора Moisés Macero García "Learn Microservices with Spring Boot".

Приложение представляет собой платформу для тренировки умственных способностей человека путем перемножения в уме двузначных чисел. 
Для большей эффективности тренировок предполагается, что пользователь должен посещять страницу хотя бы раз в день.

При первом посещении страницы программа случайным образом генерирует два двузначных числа, которые предлагается посетителю перемножить. 
Ответ посетитель записывает в отдельное поле ввода. 

Для просмотра истории своих попыток, пользователю предлагается указывать своё имя при каждом входе на страницу. История попыток подгружается автоматически 
при отправке новых сведений на сервер.

За успешное решение задач пользователю начисляются очки. За очки пользователям выдаются значки. 
Также в системе ведется список лидеров.

# Структура проекта

Проект состоит из четырех подпроектов, оформленных в виде подмодулей:
* фронтенд;
* бэкенд в виде микросервиса gateway;
* бэкенд в виде микросервиса multiplication;
* бэкенд в виде микросервиса gamification.

Фронтенд написан на React. Фронтенд представляет собой минимальное приложение, достаточное для тестирования бэкенда. В связи с этим он реализован на классовых компонентах,в нем
не используется Redux, написан на TypeScript но с расширением файлов js, нет юнит-тестов, а адреса и порты бэкенда вообще заданы константами, вместо вынесения их в .env файлы. 
Приведение фронтенда в порядок в виде задачи не ставилось.

Бэкенд написан на Spring, с использованием Spring Boot. В качестве базы данных используется H2.
Микросервис multiplication отвечает за самую главную функциональность проекта - генерацию заданий, ведение пользователей, ведение истории попыток.
Микросервис gamification отвечает за начисление очков, значков и ведение списка лидеров.
Микросервис gateway является входным шлюзом.

# Требования

Для работы приложения необходимо установить:
* Java 17
* NodeJS 12 или новее
* RabbitMQ
* [Consul](https://www.consul.io/downloads)

Для работы приложение использует следующие порты:
* 8000 порт для сервиса gateway
* 8080 порт для сервиса multiplication;
* 8081 порт для сервиса gamification;
* 3000 порт для фронтенда (порт для работы не критичен: в случае, если порт занят, выберется ближайший свободный);
* 15672 порт для RabbitMQ;
* 8500 порт для сервиса Consul.

Передача событий от сервиса multiplication сервису gamification реализована через RabbitMQ. Для подключения к RabbitMQ используются параметры по-умолчанию (username=guest, password=guest, port=15672).

Для работы базы данных в домашней директории пользователя, от чьего имени запускается бэкенд, будут созданы базы данных multiplication3 и gamification. 
Соответственно, посторонние одноименные файлы multiplication3.mv.db, multiplication3.trace.db, gamification.mv.db перед первым запуском должны отсутствовать в домашней директории пользователя.
В качестве discovery-сервиса используется [Consul](https://www.consul.io/downloads).

В качестве сервера централизованной конфигурации используется также [Consul](https://www.consul.io/downloads). Перед первым запуском необходимо создать на сервере конфигрурации дефолтные конфигурации.
Для этого необходимо:
1. Запустить Consul: `consul agent -node=learnmicro -dev`
2. Открыть панель администрирования: http://localhost:8500/
3. Создать две конфигурации
- config/defaults/application.yml с содержимым:
```yaml
logging:
  level:
    org.springframework.core.env: DEBUG
```
- config/defaults,production/application.yml с содержимым:
```yaml
logging:
  level:
    org.springframework.core.env: INFO
```

# Запуск приложения

Для запуска приложения необходимо:

1. Скачать git-подмодули, выполнив команды:

```
git submodule init
git submodule update
```

2. Запустить Consul

```
consul agent -node=learnmicro -dev
```

3. Запустить RabbitMQ

4. Запустить бэкенд. Для этого в каталогах multiplication, gamification и gateway необходимо выполнить команду:

```
./mvnw spring-boot:run
```

5. В каталоге frontend выполнить команды:

```
npm i
npm start
```
